<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <title>Display Article</title>
</head>
<body>
    <div class="container">
        <div class="row navbar bg-light align-items-center">
            <div class="col-6">
                <a class="nav-link" href="/home"><h4>pyBook</h4></a>
            </div>
            <div class="col-6">
                <ul class="nav justify-content-end">
                  <li class="nav-item">
                    <a class="nav-link" id="signup_link" href="/signup">SignUp</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="signin_link" href="/signin">SignIn</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="signout_link" href="#">SignOut</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="myinfo_link" href="/myinfo">MyInfo</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="create_article_link" href="/create_article">상품등록</a>
                  </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container mt-5">
        <div class="row justify-content-center" id="article_title_div">
        </div>
        <div class="row justify-content-center">
            <div class="col-9">
                <hr>
            </div>
        </div>
        <div class="text-center" id="confirm_deletion_div"></div>
    </div>
    <div class="container mt-3">
        <div class="row justify-content-center" id="article_desc_div">
        </div>
    </div>
    <div class="container mt-3">
        <div class="row justify-content-center" id="article_image_div">
            <div class="col-9" style="text-align: center">
                <figure class="figure" id="article_image_fig">
                </figure>
            </div>
        </div>
    </div>
    <div class="container mt-1 mb-5">
        <div class="row justify-content-center">
            <div class="col-9">
                <hr>
            </div>
        </div>
        <div class="row justify-content-center align-items-center">
            <div class="col-1">
            </div>
            <div class="col-6" id="leave_reply_div">
                <form>
                    <textarea type="text" class="form-control" id="reply_input" rows="2"></textarea>
                </form>
            </div>
            <div class="col-2" id="leave_reply_button_div">
                <button type="button" class="btn btn-primary" id="leave_reply_button">남기기</button>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-9">
                <hr>
            </div>
        </div>
        <div class="row justify-content-center" id="display_reply_div">
            <div class="row justify-content-center">
                <div class="col-1">
                </div>
                <div class="col-6">
                    <div class="row">
                        <div class="col-2">
                            reizel
                        </div>
                        <div class="col-7">
                            제가 그 책 사고 싶습니다.
                        </div>
                    </div>
                </div>
                <div class="col-2" id="delete_reply_button_div">
                    <button type="button" class="btn btn-secondary btn-sm" data-replyNo="1" id="delete_reply_button">삭제</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="/static/js/navbar.js"></script>
<script type="text/javascript" src="/static/js/display_article.js"></script>
<script>
    const replyInput = document.querySelector('#reply_input');
    const leaveReplyButton = document.querySelector('#leave_reply_button');
    const displayReplyDiv = document.querySelector('#display_reply_div');

    function isDescriptionValid() {
        return replyInput.value.length > 0
    }

    function onLeaveReplyHandler() {
        const articleNo = getArticleNo();
        let isDescriptionValid = isDescriptionValid();

        if(isDescriptionValid === true){
            let headerData = new Headers();
            let authToken = sessionStorage.getItem("authtoken");
            if(authToken){
                headerData.set("authtoken", authToken);
            }

            let formData = new FormData();

            formData.set("articleNo", articleNo);
            formData.set("reply", replyInput.value);

            fetch('/api/reply/create', {
                method: 'POST',
                headers: headerData,
                body: formData
            }).then((response) => {
                return response.json();
            }).then((resBody) => {
                const author = resBody["author"];
                const desc = resBody["description"];
                const replyNo = resBody["replyNo"];

                let replyContainer = document.createElement('div');
                replyContainer.className = 'row';

                let reply = `<div class="col-3">${author}</div>
                    <div class="col-9">${desc}</div>`;

                replyContainer.innerHTML = reply;

                displayReplyDiv.appendChild(replyContainer);











            }).catch((error) => {
                console.log('[Error]create_article.onSubmitHandler:', error);
            });
        }
    }

    leaveReplyButton.addEventListener('click', onLeaveReplyHandler);
</script>
</html>